<div class="modern-page-container">
  <!-- Tabla Moderna -->
  <div class="modern-table-section">
    <nz-table
      #outstandingBachelors
      [nzData]="bachelors"
      [nzPageSize]="pageSize"
      nzShowSizeChanger
      [nzLoading]="loadingData"
      [nzFrontPagination]="false"
      class="elegant-table"
      nzSize="middle">
      <thead>
        <tr>
          <th nzWidth="60px">#</th>
          <th nzWidth="80px">Género</th>
          <th nzWidth="120px">Código RUDE</th>
          <th nzWidth="120px">C.I.</th>
          <th>Apellido Paterno</th>
          <th>Apellido Materno</th>
          <th>Nombre(s)</th>
          <th nzWidth="100px">Turno</th>
          <th nzWidth="100px">Paralelo</th>
          <th nzWidth="130px" nzRight="true">Promedio</th>
          <th nzWidth="120px">Acción</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let estudiante of outstandingBachelors.data; let i = index"
            class="table-row">
          <td>
            <div class="student-index">{{ i + 1 }}</div>
          </td>
          <td>
            <nz-tag [nzColor]="estudiante.genero === 'MASCULINO' ? 'blue' : 'pink'">
              {{ estudiante.genero }}
            </nz-tag>
          </td>
          <td>
            <span class="data-value">{{ estudiante.codigo_rude || '--' }}</span>
          </td>
          <td>
            <span class="data-value">{{ estudiante.carnet_identidad || '--' }}</span>
          </td>
          <td>
            <span class="data-value">{{ estudiante.paterno || '--' }}</span>
          </td>
          <td>
            <span class="data-value">{{ estudiante.materno || '--' }}</span>
          </td>
          <td>
            <strong class="student-name">{{ estudiante.nombre || '--' }}</strong>
          </td>
          <td>
            <span class="data-value">{{ estudiante.turno || '--' }}</span>
          </td>
          <td>
            <span class="data-value">{{ estudiante.paralelo || '--' }}</span>
          </td>
          <td class="text-right">
            <div class="score-badge" [class.high-score]="estudiante.nota_cuant_prom >= '90'">
              <span class="score-value">{{ estudiante.nota_cuant_prom }}</span>
              <i nz-icon nzType="rise" nzTheme="outline"
                 *ngIf="estudiante.nota_cuant_prom >= '90'"
                 class="score-trend"></i>
            </div>
          </td>
          <td>
            <button
              nz-button
              nzType="link"
              nzSize="small"
              [nzLoading]="estudiante.genero === 'FEMENINO' ? loadingFeminine : loadingMasculine"
              (click)="checkCalculation(estudiante.genero)"
              class="action-btn">
              <i nz-icon nzType="calculator" nzTheme="outline"></i>
              Revisar
            </button>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <!-- Panel de Conformidad Mejorado -->
  <div class="approval-panel" [class.approved]="isSatisfied">
    <div class="approval-content">
      <div class="approval-icon">
        <i nz-icon [nzType]="isSatisfied ? 'check-circle' : 'exclamation-circle'"
           [nzTheme]="isSatisfied ? 'fill' : 'outline'"
           [class.checked]="isSatisfied"></i>
      </div>
      <div class="approval-text">
        <h3>Confirmación de Conformidad</h3>
        <p>Declaro que he revisado y estoy de acuerdo con la selección de estudiantes como Bachilleres Destacados</p>
      </div>
      <div class="approval-action">
        <label
          nz-checkbox
          name="estaConforme"
          [(ngModel)]="isSatisfied"
          class="modern-checkbox"
        >
          <!-- [nzDisabled]="bachelors.length === 0" -->
          <span class="checkbox-label">
            {{ isSatisfied ? 'Confirmado' : 'Confirmar Selección' }}
          </span>
        </label>
      </div>
    </div>
  </div>

  <!-- Panel de Acción Final -->
  <div class="action-panel" [class.enabled]="isSatisfied">
    <div class="action-content">
      <div class="action-info">
        <h3>Finalizar Proceso</h3>
        <p>Complete el registro oficial de los estudiantes seleccionados</p>
      </div>
      <div class="action-buttons">
        <!-- <button
          nz-button
          nzType="default"
          nzSize="large"
          class="secondary-btn">
          <i nz-icon nzType="printer" nzTheme="outline"></i>
          Vista Previa
        </button> -->
        <button
          nz-button
          nzType="primary"
          nzSize="large"
          (click)="openDialog(consolidateTpl)"
          [disabled]="!isSatisfied"
          [nzLoading]="loadingConsolidate"
          class="primary-action-btn">
          <i nz-icon nzType="file-done" nzTheme="outline"></i>
          Registrar e Imprimir DDJJ
        </button>
        <ng-template #consolidateTpl>
          <nz-alert
            nzType="error"
            nzShowIcon
            [nzMessage]="dialog"
          ></nz-alert>
        </ng-template>
      </div>
    </div>
  </div>

  <div class="important-highlight">
    <div class="icon">⚠️</div>
    <div class="text">
      <h3>¡Importante!</h3>
      <ul>
        <li>La conformidad es responsabilidad única y exclusiva del director de la U.E.</li>
        <li>Si no está de acuerdo con los candidatos, deberá presentar una nota formal con antecedentes.</li>
      </ul>
    </div>
  </div>
</div>